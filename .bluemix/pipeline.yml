---
stages:
- name: Extract & Build
  inputs:
  - type: git
    branch: master
  triggers:
  - type: commit
  jobs:
  - name: Get changes
    type: builder
    build_type: shell
    script: |-
      #!/bin/bash
      # This script just dumps the changes included in this build into a file named changelog.txt
      # This change log can be used later to be included in notifications
      git log ${GIT_COMMIT}..HEAD --graph --oneline > changelog.txt
      cat changelog.txt
- name: Extract & Build
  inputs:
  - type: job
    stage: Get changes
    job: Get changes
  triggers:
  - type: commit
  properties:
  - name: NEW_RELIC_LICENSE_KEY
    value: ''
    type: text
  jobs:
  - name: NewRelic
    type: builder
    build_type: shell
    script: |-
      #!/bin/bash
      if [ -z ${NEW_RELIC_LICENSE_KEY+x} ];
      then
        echo "NewRelic is disabled.  Please specify your API NewRelic API key.";
      else
        npm install newrelic
        cp node_modules/newrelic/newrelic.js ./
        mkdir .newrelic
        echo ${NEW_RELIC_LICENSE_KEY} > .newrelic/key;
      fi
